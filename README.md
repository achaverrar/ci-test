# URL Shortener Server

![Java](https://img.shields.io/badge/Java-17-555555?logo=openjdk&logoColor=white&labelColor=%23ED8B00) ![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3%2E5%2E5-555555?logo=springboot&logoColor=white&labelColor=%236DB33F) ![Maven](https://img.shields.io/badge/Maven-3%2E9%2E11-555555?logo=apachemaven&logoColor=white&labelColor=%23C71A36) ![Postgres](https://img.shields.io/badge/Postgres-17%2E5-555555?logo=postgresql&logoColor=white&labelColor=%234169E1) ![Dockerized](https://img.shields.io/badge/Dockerized-2496ED?logo=docker&logoColor=white) [![License](https://img.shields.io/badge/MIT-555555?label=License&labelColor=yellow)](./LICENSE)

This project is a Spring Boot API that powers a URL shortening application. It provides endpoints to generate and access short links, handling requests and redirects.

The repository is intended to showcase my backend development skills and includes supporting artifacts in the [docs/](./docs/) folder, documenting the planning and design decisions behind the system.

## Table of contents

- [Features](#features)
- [Technologies](#technologies)
- [Start the server](#start-the-server)
  - [Set environment variables](#set-environment-variables)
  - [Profiles](#profiles)
  - [Run in containers](#run-in-containers)
  - [Run locally](#run-locally)
    - [Dev profile (default)](#dev-profile-default)
    - [Prod profile](#prod-profile)
    - [Troubles](#troubleshooting)
- [License](#license)

---

## Features

The core functionality of the application includes the following:

- Shorten long URLs into unique, shareable links
- Retrieve metadata for shortened URLs
- Redirect users from a short link to its original URL
- Automatically remove expired links

---

## Technologies

- Java 17
- Spring Boot 3.5 (Web, Validation, Data JPA, Actuator)
- Maven 3.9
- PostgreSQL 17.5
- Flyway
- P6spy
- Lombok
- MapStruct
- Docker + Docker Compose
- Testcontainers
- JUnit 5
- REST Assured

---

## Start the server

### Set environment variables

You can start the server in one of two ways:

- **In containers** using Docker and Docker Compose.
- **Locally** with Java 17, PostgreSQL 17.5 and Maven 3.9 (wrapper included).

Before starting the server, copy `.env.example` to `.env` at the project root and fill in the following environment variables:

```
SERVER_PORT= # Port that exposes the Spring Boot server
BUILD_PROFILE= # Maven profile used to build the application jar
DATABASE_NAME= # Database name
SPRING_DATASOURCE_URL= # Database URL
SPRING_DATASOURCE_USERNAME= # Database username
SPRING_DATASOURCE_PASSWORD= # Database password
```

- Where `SPRING_DATASOURCE_URL` uses a different protocol depending on the active profile.

### Profiles

The project has two Maven profiles: `dev` and `prod`. By default, the `dev` profile is used locally.

- In **dev** (development):

```
BUILD_PROFILE=dev
SPRING_DATASOURCE_URL=jdbc:p6spy:postgresql://database:5432/<DATABASE_NAME>
```

- In **prod** (production):

```
BUILD_PROFILE=prod
SPRING_DATASOURCE_URL=jdbc:postgresql://database:5432/<DATABASE_NAME>
```

### Run in containers

- Build and start the server and PostgreSQL database from the project root:

  ```bash
  docker compose up --build -d
  ```

- Access the backend at: `http://localhost:${SERVER_PORT}`.
- Stop the server and remove associated volumes:

  ```bash
  docker compose down -v
  ```

### Run locally

Before executing these commands, make sure:

- The database defined in your `.env` is running and accessible.
- You have no commented lines in your `.env` file.

#### Dev profile (default)

- Run directly from source:

  ```bash
  export $(cat .env | xargs)
  ./mvnw spring-boot:run
  ```

- Or build the JAR first and run it:
  ```bash
  export $(cat .env | xargs)
  ./mvnw clean package -Pdev
  java -jar target/url-shortener-*.jar
  ```

#### Prod profile

- Before building, temporarily comment out this line in `pom.xml`:
  ```xml
  <exclude>application-*.yaml</exclude>
  ```
- Then build and run with the production profile:
  ```bash
  export $(cat .env | xargs)
  ./mvnw clean package -Pprod
  java -jar target/url-shortener-*.jar --spring.profiles.active=prod
  ```
- The server will start on `http://localhost:${SERVER_PORT}` and connect to the database configured for that profile.
- Stop the server by pressing `Ctrl+C` in the terminal.
- Run tests:
  ```bash
  ./mvnw test
  ```

---

### Troubleshooting

If you are using **Eclipse** or **Spring Tool Suite (STS)** and the project fails to compile because methods generated by Lombok annotations cannot be resolved, install the Lombok plugin for your IDE by following the [official guide](https://projectlombok.org/setup/eclipse).

## License

This project is licensed under the [MIT License](./LICENSE).
